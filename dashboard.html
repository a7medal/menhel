<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="UTF-8">
  <title>لوحة التحكم - المنهل</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="/manifest.json">
</head>
<body>
  <!-- الهيدر -->
  <header class="dashboard-header" style="position: relative;">
    <div class="header-left">
      <img src="logo1.png" class="header-logo" alt="شعار المنهل">
      <h1 id="branchName"></h1>
    </div>
    <button class="logout-btn" onclick="logout()">
      <span class="material-icons">logout</span>
    </button>
    <div id="notification-icon" style="position: relative; cursor: pointer;">
      <i class="material-icons" style="font-size: 24px;">notifications</i>
      <span id="notification-badge" style="position: absolute; top: 0; right: 0; background-color: red; color: white; border-radius: 50%; padding: 3px 6px; font-size: 12px; display: none;">0</span>
    </div>
    <div id="notifications-menu" style="display:none; position: absolute; top: 60px; left: 10px; background: white; border: 1px solid #ccc; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-radius: 6px; width: 280px; max-height: 300px; overflow-y: auto; z-index: 999;">
    </div>
  </header>

  <!-- المحتوى الرئيسي -->
  <main class="main-content">
    <div id="dashboard">
      <div class="cards-container" id="cardsContainer"></div>
    </div>
  </main>

  <!-- الفوتر -->
  <footer class="auto-update-notice">
    <div class="notice-content">
      <span class="material-icons">info</span>
      <p>جميع تحديثات الهوية البصرية يتم تحديثها تلقائيًا عبر النظام</p>
    </div>
  </footer>

  <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async></script>
  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
      await OneSignal.init({
        appId: "7d5bdcc4-50a4-47a5-a933-b37a8242d05c",
        serviceWorkerPath: 'OneSignalSDKWorker.js',
        serviceWorkerUpdaterPath: 'OneSignalSDKUpdaterWorker.js',
      });

      OneSignal.on('notificationDisplay', function(event) {
        const message = `${event.heading || ''} - ${event.content || ''}`;
        addNotification(message);
      });
    });
  </script>

  <script>
    // تحميل الإشعارات من التخزين المحلي
    let notifications = JSON.parse(localStorage.getItem('notifications')) || [];

    const icon = document.getElementById('notification-icon');
    const badge = document.getElementById('notification-badge');
    const menu = document.getElementById('notifications-menu');

    function renderNotifications() {
      menu.innerHTML = '';
      if (notifications.length === 0) {
        menu.innerHTML = '<p style="padding: 10px;">لا توجد لديك إشعارات جديدة.</p>';
        badge.style.display = 'none';
        return;
      }

      notifications.forEach((note, i) => {
        const item = document.createElement('div');
        item.style.borderBottom = '1px solid #eee';
        item.style.padding = '10px';
        item.innerHTML = `
          <p style="margin:0;">${note}</p>
          <button onclick="markAsRead(${i})" style="margin-top:5px; color:red; font-size:12px;">تمت القراءة</button>
        `;
        menu.appendChild(item);
      });

      badge.style.display = 'block';
      badge.innerText = notifications.length;
    }

    function markAsRead(index) {
      notifications.splice(index, 1);
      localStorage.setItem('notifications', JSON.stringify(notifications));
      renderNotifications();
    }

    function addNotification(message) {
      notifications.push(message);
      localStorage.setItem('notifications', JSON.stringify(notifications));
      renderNotifications();
    }

    icon.addEventListener('click', () => {
      menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    });

    renderNotifications();
  </script>
</body>
</html>