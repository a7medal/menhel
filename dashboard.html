<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="UTF-8">
  <title>لوحة التحكم - المنهل</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="/manifest.json">
</head>
<body>
  <!-- الهيدر -->
  <header class="dashboard-header">
    <div class="header-left">
      <img src="logo1.png" class="header-logo" alt="شعار المنهل">
      <h1 id="branchName"></h1>
    </div>
    <button class="logout-btn" onclick="logout()">
      <span class="material-icons">logout</span>
    </button>
    <div id="notification-icon" style="position: relative; cursor: pointer;">
      <i class="material-icons" style="font-size: 24px;">notifications</i>
      <span id="notification-badge" style="position: absolute; top: 0; right: 0; background-color: red; color: white; border-radius: 50%; padding: 2px 6px; font-size: 12px; display: none;">0</span>
    </div>
  </header>

  <!-- المحتوى الرئيسي -->
  <main class="main-content">
    <div id="dashboard">
      <div class="cards-container" id="cardsContainer"></div>
    </div>
  </main>

  <!-- الفوتر -->
  <footer class="auto-update-notice">
    <div class="notice-content">
      <span class="material-icons">info</span>
      <p>جميع تحديثات الهوية البصرية يتم تحديثها تلقائيًا عبر النظام</p>
    </div>
  </footer>

  <!-- سكريبت OneSignal -->
  <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
      await OneSignal.init({
        appId: "7d5bdcc4-50a4-47a5-a933-b37a8242d05c",
        serviceWorkerPath: 'OneSignalSDKWorker.js',
        serviceWorkerUpdaterPath: 'OneSignalSDKUpdaterWorker.js',
      });
    });
  </script>

  <!-- سكريبت الإشعارات -->
  <script>
    const notificationIcon = document.getElementById('notification-icon');
    const notificationBadge = document.getElementById('notification-badge');
    let notifications = JSON.parse(localStorage.getItem('notifications')) || [];
    let containerOpen = false;
    let containerElement = null;

    function updateBadge() {
      notifications = JSON.parse(localStorage.getItem('notifications')) || [];
      if (notifications.length > 0) {
        notificationBadge.style.display = 'block';
        notificationBadge.innerText = notifications.length;
      } else {
        notificationBadge.style.display = 'none';
      }
    }

    function markAsRead(index) {
      notifications.splice(index, 1);
      localStorage.setItem('notifications', JSON.stringify(notifications));
      updateBadge();
      if (containerOpen) {
        containerElement.remove();
        containerOpen = false;
      }
    }

    function showNotifications() {
      if (containerOpen && containerElement) {
        containerElement.remove();
        containerOpen = false;
        return;
      }

      containerElement = document.createElement('div');
      containerElement.style.position = 'absolute';
      containerElement.style.top = '40px';
      containerElement.style.left = '0';
      containerElement.style.background = 'white';
      containerElement.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
      containerElement.style.padding = '10px';
      containerElement.style.minWidth = '250px';
      containerElement.style.borderRadius = '8px';
      containerElement.style.zIndex = '9999';
      containerElement.style.textAlign = 'right';

      if (notifications.length > 0) {
        notifications.forEach((notification, index) => {
          const item = document.createElement('div');
          item.style.borderBottom = '1px solid #ccc';
          item.style.padding = '5px 0';
          item.innerHTML = `
            <p style="margin: 0 0 5px 0;">${notification}</p>
            <button onclick="markAsRead(${index})" style="background-color: #d33; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">تمت قراءته</button>
          `;
          containerElement.appendChild(item);
        });
      } else {
        containerElement.innerHTML = '<p>لا توجد إشعارات جديدة.</p>';
      }

      notificationIcon.appendChild(containerElement);
      containerOpen = true;
    }

    notificationIcon.addEventListener('click', showNotifications);
    updateBadge();

    // لاختبار إضافة إشعار يدويًا
    function addNotification(message) {
      const current = JSON.parse(localStorage.getItem('notifications')) || [];
      current.push(message);
      localStorage.setItem('notifications', JSON.stringify(current));
      updateBadge();
    }
addNotification("هذا إشعار تجريبي");
    // مثال: addNotification("تمت إضافة إشعار جديد!");
  </script>

  <!-- سكريبت رئيسي -->
  <script src="script.js"></script>
</body>
</html>